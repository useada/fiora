(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{1121:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(119),o=n.n(c),i=n(353),s=n.n(i),l=(n(451),n(3)),u=n(33),p=n(29),m=n(36),f=n(107),h=n(108),v=n(37),b=n(15),g=n(6),d=n(20),w=n(109),x=n(66),y=n.n(x),E=n(5),N=n.n(E);function j(e,t,n,a,r,c,o){try{var i=e[c](o),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(a,r)}function O(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var c=e.apply(t,n);function o(e){j(c,a,r,o,i,"next",e)}function i(e){j(c,a,r,o,i,"throw",e)}o(void 0)}))}}function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],a=!0,r=!1,c=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){r=!0,c=e}finally{try{a||null==i.return||i.return()}finally{if(r)throw c}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}t.default=function(e){var t=e.visible,n=e.onClose,c=Object(d.a)(),i=Object(l.d)((function(e){return e.user._id})),x=Object(l.d)((function(e){return e.user.avatar})),E=Object(l.d)((function(e){return e.status.primaryColor})),j=R(Object(a.useState)(!1),2),k=j[0],A=j[1],C=R(Object(a.useState)({enable:!1,src:"",ext:""}),2),I=C[0],S=C[1],H=Object(a.useRef)(null);function L(e){return T.apply(this,arguments)}function T(){return(T=O(regeneratorRuntime.mark((function e(t){var n,a,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:"png",A(!0),e.prev=2,e.next=5,Object(h.a)(t,"Avatar/".concat(i,"_").concat(Date.now()),"Avatar_".concat(i,"_").concat(Date.now(),".").concat(n));case 5:return a=e.sent,e.next=8,Object(g.b)(a);case 8:e.sent&&(c.setAvatar(URL.createObjectURL(t)),b.a.success("修改头像成功")),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error(e.t0),b.a.error("上传头像失败");case 16:return e.prev=16,A(!1),S({enable:!1,src:"",ext:""}),e.finish(16);case 20:case"end":return e.stop()}}),e,null,[[2,12,16,20]])})))).apply(this,arguments)}function B(){return(B=O(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.a)("blob","image/png,image/jpeg,image/gif");case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(!(t.length>v.a.maxAvatarSize)){e.next=7;break}return e.abrupt("return",b.a.error("设置头像失败, 请选择小于1MB的图片"));case 7:"gif"===t.ext?L(t.result,t.ext):((n=new FileReader).readAsDataURL(t.result),n.onloadend=function(){S({enable:!0,src:n.result,ext:t.ext})});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){c.logout(),window.localStorage.removeItem("token"),b.a.success(e),w.a.disconnect(),w.a.connect()}var _=R(Object(a.useState)(""),2),D=_[0],M=_[1],U=R(Object(a.useState)(""),2),X=U[0],Z=U[1];function J(){return(J=O(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(g.e)(D,X);case 2:e.sent&&(n(),G("修改密码成功, 请使用新密码重新登录"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P=R(Object(a.useState)(""),2),W=P[0],Y=P[1];function z(){return(z=O(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(g.f)(W);case 2:e.sent&&(n(),G("修改用户名成功, 请使用新用户名重新登录"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.a.createElement(u.a,{className:y.a.selfInfo,visible:t,title:"个人信息设置",onClose:function(e){"rc-dialog-close-x"!==e.target.className&&I.enable||n()}},r.a.createElement("div",{className:N.a.container},r.a.createElement("div",{className:N.a.block},r.a.createElement("p",{className:N.a.title},"修改头像"),r.a.createElement("div",{className:y.a.changeAvatar},I.enable?r.a.createElement("div",{className:y.a.cropper},r.a.createElement(s.a,{className:k?"blur":"",ref:H,src:I.src,style:{width:460,height:460},aspectRatio:1}),r.a.createElement(p.a,{className:y.a.button,onClick:function(){H.current.getCroppedCanvas().toBlob(function(){var e=O(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:L(t,I.ext);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},"修改头像"),r.a.createElement(o.a,{className:"".concat(y.a.loading," ").concat(k?"show":"hide"),type:"spinningBubbles",color:"rgb(".concat(E),height:120,width:120})):r.a.createElement("div",{className:y.a.preview},r.a.createElement("img",{className:k?"blur":"",alt:"头像预览",src:x,onClick:function(){return B.apply(this,arguments)}}),r.a.createElement(o.a,{className:"".concat(y.a.loading," ").concat(k?"show":"hide"),type:"spinningBubbles",color:"rgb(".concat(E),height:80,width:80})))),r.a.createElement("div",{className:N.a.block},r.a.createElement("p",{className:N.a.title},"修改密码"),r.a.createElement("div",null,r.a.createElement(m.a,{className:y.a.input,value:D,onChange:M,type:"password",placeholder:"旧密码"}),r.a.createElement(m.a,{className:y.a.input,value:X,onChange:Z,type:"password",placeholder:"新密码"}),r.a.createElement(p.a,{className:y.a.button,onClick:function(){return J.apply(this,arguments)}},"确认修改"))),r.a.createElement("div",{className:N.a.block},r.a.createElement("p",{className:N.a.title},"修改用户名"),r.a.createElement("div",null,r.a.createElement(m.a,{className:y.a.input,value:W,onChange:Y,type:"text",placeholder:"用户名"}),r.a.createElement(p.a,{className:y.a.button,onClick:function(){return z.apply(this,arguments)}},"确认修改")))))}},453:function(e,t,n){(t=n(10)(!1)).push([e.i,".selfInfo--2vfgi {\n  height: initial !important;\n  width: 500px;\n}\n.changeAvatar--1ZwL2 {\n  position: relative;\n}\n.changeAvatar--1ZwL2 .blur--3Orga {\n  filter: blur(2px);\n}\n.cropper--HXl2p > div {\n  margin-bottom: 8px;\n}\n.cropper--HXl2p .loading--2IhAG {\n  top: 170px;\n  left: 170px;\n}\n.preview--3xRTH > img {\n  width: 100px;\n  height: 100px;\n  cursor: pointer;\n}\n.preview--3xRTH > img:hover {\n  filter: blur(3px);\n}\n.preview--3xRTH .loading--2IhAG {\n  top: 10px;\n  left: 10px;\n}\n.loading--2IhAG {\n  position: absolute;\n  pointer-events: none;\n}\n.input--2wMW6 {\n  height: 36px;\n  margin-bottom: 8px;\n}\n.button--2Y-h1 {\n  width: 100px;\n  height: 36px;\n}\n",""]),t.locals={selfInfo:"selfInfo--2vfgi",changeAvatar:"changeAvatar--1ZwL2",blur:"blur--3Orga",cropper:"cropper--HXl2p",loading:"loading--2IhAG",preview:"preview--3xRTH",input:"input--2wMW6",button:"button--2Y-h1"},e.exports=t},66:function(e,t,n){var a=n(453);"string"==typeof a&&(a=[[e.i,a,""]]);n(11)(a,{});a.locals&&(e.exports=a.locals)}}]);